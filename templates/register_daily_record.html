{% extends "topmenu_template.html" %}

{% block title %}Registro Diario{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Registro Diario de Unidad</h1>
    <form method="POST" action="{{ url_for('register_daily_record.register_daily_record') }}">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.unit_id.label(class="form-label") }}
            {{ form.unit_id(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.nombre_chofer.label(class="form-label") }}
            {{ form.nombre_chofer(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.fecha.label(class="form-label") }}
            {{ form.fecha(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.boleto_inicial.label(class="form-label") }}
            {{ form.boleto_inicial(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.boleto_entregado.label(class="form-label") }}
            {{ form.boleto_entregado(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.cantidad_dinero_esperado.label(class="form-label") }}
            {{ form.cantidad_dinero_esperado(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.dinero_entregado.label(class="form-label") }}
            {{ form.dinero_entregado(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.restante.label(class="form-label") }}
            {{ form.restante(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.dueño_unidad.label(class="form-label") }}
            {{ form.dueño_unidad(class="form-control") }}
            <small id="ownerName" class="form-text text-muted"></small>
        </div>
        <div class="form-group text-center">
            {{ form.submit(class="btn btn-primary") }}
        </div>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
$(document).ready(function() {
    $('#unit_id').on('blur', function() {
        var unitId = $(this).val();
        if (unitId) {
            $.ajax({
                url: "{{ url_for('register_daily_record.get_unit_owner') }}",
                type: "POST",
                data: { unit_id: unitId },
                success: function(response) {
                    $('#ownerName').text(response.owner_name);
                },
                error: function() {
                    $('#ownerName').text('Error al obtener el nombre del dueño.');
                }
            });
        } else {
            $('#ownerName').text('');
        }
    });
});
</script>
{% endblock %}
