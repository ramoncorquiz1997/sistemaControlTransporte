{% extends "topmenu_template.html" %}

{% block title %}Registro Diario{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Registro Diario de Unidad</h1>
    <form method="POST" action="{{ url_for('register_daily_record.register_daily_record') }}">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.unit_id.label(class="form-label") }}
            {{ form.unit_id(class="form-control", id="unit_id") }}
        </div>
        <div class="form-group">
            {{ form.nombre_chofer.label(class="form-label") }}
            {{ form.nombre_chofer(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.fecha.label(class="form-label") }}
            {{ form.fecha(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.boleto_inicial.label(class="form-label") }}
            {{ form.boleto_inicial(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.boleto_entregado.label(class="form-label") }}
            {{ form.boleto_entregado(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.cantidad_dinero_esperado.label(class="form-label") }}
            {{ form.cantidad_dinero_esperado(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.dinero_entregado.label(class="form-label") }}
            {{ form.dinero_entregado(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.restante.label(class="form-label") }}
            {{ form.restante(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.dueño_unidad.label(class="form-label") }}
            {{ form.dueño_unidad(class="form-control", id="unit_owner", readonly=True) }}
        </div>
        <div class="form-group text-center">
            {{ form.submit(class="btn btn-primary") }}
        </div>
    </form>
</div>

<script>
    document.getElementById('unit_id').addEventListener('change', function() {
        const unitId = this.value;
        fetch('{{ url_for("register_daily_record.get_unit_owner") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'
            },
            body: JSON.stringify({ unit_id: unitId })
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('unit_owner').value = data.owner_name;
        })
        .catch(error => console.error('Error:', error));
    });
</script>
{% endblock %}
